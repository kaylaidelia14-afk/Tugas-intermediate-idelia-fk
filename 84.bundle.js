/*! For license information please see 84.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkapp_starter_project_with_webpack=self.webpackChunkapp_starter_project_with_webpack||[]).push([[84],{84:(n,t,e)=>{e.r(t),e.d(t,{setupAutoSync:()=>x,syncOfflineStories:()=>g});var r=e(652),o=e(255);function c(n){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},c(n)}function i(n,t){var e="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(!e){if(Array.isArray(n)||(e=function(n,t){if(n){if("string"==typeof n)return a(n,t);var e={}.toString.call(n).slice(8,-1);return"Object"===e&&n.constructor&&(e=n.constructor.name),"Map"===e||"Set"===e?Array.from(n):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?a(n,t):void 0}}(n))||t&&n&&"number"==typeof n.length){e&&(n=e);var r=0,o=function(){};return{s:o,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(n){throw n},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,i=!0,u=!1;return{s:function(){e=e.call(n)},n:function(){var n=e.next();return i=n.done,n},e:function(n){u=!0,c=n},f:function(){try{i||null==e.return||e.return()}finally{if(u)throw c}}}}function a(n,t){(null==t||t>n.length)&&(t=n.length);for(var e=0,r=Array(t);e<t;e++)r[e]=n[e];return r}function u(){var n=h(),t=n.m(u),e=(Object.getPrototypeOf?Object.getPrototypeOf(t):t.__proto__).constructor;function r(n){var t="function"==typeof n&&n.constructor;return!!t&&(t===e||"GeneratorFunction"===(t.displayName||t.name))}var o={throw:1,return:2,break:3,continue:3};function c(n){var t,e;return function(r){t||(t={stop:function(){return e(r.a,2)},catch:function(){return r.v},abrupt:function(n,t){return e(r.a,o[n],t)},delegateYield:function(n,o,c){return t.resultName=o,e(r.d,s(n),c)},finish:function(n){return e(r.f,n)}},e=function(n,e,o){r.p=t.prev,r.n=t.next;try{return n(e,o)}finally{t.next=r.n}}),t.resultName&&(t[t.resultName]=r.v,t.resultName=void 0),t.sent=r.v,t.next=r.n;try{return n.call(this,t)}finally{r.p=t.prev,r.n=t.next}}}return(u=function(){return{wrap:function(t,e,r,o){return n.w(c(t),e,r,o&&o.reverse())},isGeneratorFunction:r,mark:n.m,awrap:function(n,t){return new d(n,t)},AsyncIterator:y,async:function(n,t,e,o,i){return(r(t)?p:l)(c(n),t,e,o,i)},keys:f,values:s}})()}function s(n){if(null!=n){var t=n["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],e=0;if(t)return t.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length))return{next:function(){return n&&e>=n.length&&(n=void 0),{value:n&&n[e++],done:!n}}}}throw new TypeError(c(n)+" is not iterable")}function f(n){var t=Object(n),e=[];for(var r in t)e.unshift(r);return function n(){for(;e.length;)if((r=e.pop())in t)return n.value=r,n.done=!1,n;return n.done=!0,n}}function l(n,t,e,r,o){var c=p(n,t,e,r,o);return c.next().then((function(n){return n.done?n.value:c.next()}))}function p(n,t,e,r,o){return new y(h().w(n,t,e,r),o||Promise)}function y(n,t){function e(r,o,c,i){try{var a=n[r](o),u=a.value;return u instanceof d?t.resolve(u.v).then((function(n){e("next",n,c,i)}),(function(n){e("throw",n,c,i)})):t.resolve(u).then((function(n){a.value=n,c(a)}),(function(n){return e("throw",n,c,i)}))}catch(n){i(n)}}var r;this.next||(v(y.prototype),v(y.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",(function(){return this}))),v(this,"_invoke",(function(n,o,c){function i(){return new t((function(t,r){e(n,c,t,r)}))}return r=r?r.then(i,i):i()}),!0)}function h(){var n,t,e="function"==typeof Symbol?Symbol:{},r=e.iterator||"@@iterator",o=e.toStringTag||"@@toStringTag";function c(e,r,o,c){var u=r&&r.prototype instanceof a?r:a,s=Object.create(u.prototype);return v(s,"_invoke",function(e,r,o){var c,a,u,s=0,f=o||[],l=!1,p={p:0,n:0,v:n,a:y,f:y.bind(n,4),d:function(t,e){return c=t,a=0,u=n,p.n=e,i}};function y(e,r){for(a=e,u=r,t=0;!l&&s&&!o&&t<f.length;t++){var o,c=f[t],y=p.p,h=c[2];e>3?(o=h===r)&&(u=c[(a=c[4])?5:(a=3,3)],c[4]=c[5]=n):c[0]<=y&&((o=e<2&&y<c[1])?(a=0,p.v=r,p.n=c[1]):y<h&&(o=e<3||c[0]>r||r>h)&&(c[4]=e,c[5]=r,p.n=h,a=0))}if(o||e>1)return i;throw l=!0,r}return function(o,f,h){if(s>1)throw TypeError("Generator is already running");for(l&&1===f&&y(f,h),a=f,u=h;(t=a<2?n:u)||!l;){c||(a?a<3?(a>1&&(p.n=-1),y(a,u)):p.n=u:p.v=u);try{if(s=2,c){if(a||(o="next"),t=c[o]){if(!(t=t.call(c,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,a<2&&(a=0)}else 1===a&&(t=c.return)&&t.call(c),a<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),a=1);c=n}else if((t=(l=p.n<0)?u:e.call(r,p))!==i)break}catch(t){c=n,a=1,u=t}finally{s=1}}return{value:t,done:l}}}(e,o,c),!0),s}var i={};function a(){}function u(){}function s(){}t=Object.getPrototypeOf;var f=[][r]?t(t([][r]())):(v(t={},r,(function(){return this})),t),l=s.prototype=a.prototype=Object.create(f);function p(n){return Object.setPrototypeOf?Object.setPrototypeOf(n,s):(n.__proto__=s,v(n,o,"GeneratorFunction")),n.prototype=Object.create(l),n}return u.prototype=s,v(l,"constructor",s),v(s,"constructor",u),u.displayName="GeneratorFunction",v(s,o,"GeneratorFunction"),v(l),v(l,o,"Generator"),v(l,r,(function(){return this})),v(l,"toString",(function(){return"[object Generator]"})),(h=function(){return{w:c,m:p}})()}function v(n,t,e,r){var o=Object.defineProperty;try{o({},"",{})}catch(n){o=0}v=function(n,t,e,r){function c(t,e){v(n,t,(function(n){return this._invoke(t,e,n)}))}t?o?o(n,t,{value:e,enumerable:!r,configurable:!r,writable:!r}):n[t]=e:(c("next",0),c("throw",1),c("return",2))},v(n,t,e,r)}function d(n,t){this.v=n,this.k=t}function b(n,t,e,r,o,c,i){try{var a=n[c](i),u=a.value}catch(n){return void e(n)}a.done?t(u):Promise.resolve(u).then(r,o)}function m(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var c=n.apply(t,e);function i(n){b(c,r,o,i,a,"next",n)}function a(n){b(c,r,o,i,a,"throw",n)}i(void 0)}))}}function g(){return w.apply(this,arguments)}function w(){return(w=m(u().mark((function n(){var t,e,c,a,s,f,l,p,y,h,v,d;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t=localStorage.getItem("authToken")){n.next=4;break}return console.log("[sync] No auth token, skipping sync"),n.abrupt("return",{success:!1,error:"Not authenticated"});case 4:if(navigator.onLine){n.next=7;break}return console.log("[sync] Offline, skipping sync"),n.abrupt("return",{success:!1,error:"Offline"});case 7:return n.next=9,(0,r.getUnsyncedStories)();case 9:if(0!==(e=n.sent).length){n.next=13;break}return console.log("[sync] No unsynced stories"),n.abrupt("return",{success:!0,synced:0});case 13:console.log("[sync] Found ".concat(e.length," unsynced stories")),c=o.A.BASE_URL.replace(/\/+$/,""),a=0,s=0,f=i(e),n.prev=18,f.s();case 20:if((l=f.n()).done){n.next=50;break}return p=l.value,n.prev=22,n.next=25,k(p.photo,p.photoType);case 25:return y=n.sent,(h=new FormData).append("description",p.description),h.append("photo",y,p.photoName),null!=p.lat&&null!=p.lon&&(h.append("lat",p.lat),h.append("lon",p.lon)),n.next=32,fetch("".concat(c,"/stories"),{method:"POST",headers:{Authorization:"Bearer ".concat(t)},body:h});case 32:return v=n.sent,n.next=35,v.json().catch((function(){return{}}));case 35:if(d=n.sent,v.ok&&!d.error){n.next=38;break}throw new Error(d.message||"HTTP ".concat(v.status));case 38:return n.next=40,(0,r.markStoryAsSynced)(p.id);case 40:a++,console.log("[sync] Synced story ".concat(p.id)),n.next=48;break;case 44:n.prev=44,n.t0=n.catch(22),console.error("[sync] Failed to sync story ".concat(p.id,":"),n.t0),s++;case 48:n.next=20;break;case 50:n.next=55;break;case 52:n.prev=52,n.t1=n.catch(18),f.e(n.t1);case 55:return n.prev=55,f.f(),n.finish(55);case 58:return n.abrupt("return",{success:!0,synced:a,failed:s,total:e.length});case 59:case"end":return n.stop()}}),n,null,[[18,52,55,58],[22,44]])})))).apply(this,arguments)}function k(n,t){for(var e=n.includes(",")?n.split(",")[1]:n,r=atob(e),o=new Array(r.length),c=0;c<r.length;c++)o[c]=r.charCodeAt(c);var i=new Uint8Array(o);return new Blob([i],{type:t||"image/jpeg"})}function x(){window.addEventListener("online",m(u().mark((function n(){var t;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("[sync] Connection restored, syncing offline stories..."),n.prev=1,n.next=4,g();case 4:(t=n.sent).success&&t.synced>0&&"Notification"in window&&"granted"===Notification.permission&&new Notification("Sinkronisasi Berhasil",{body:"".concat(t.synced," story berhasil disinkronisasi"),icon:"./public/images/logo.png"}),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(1),console.error("[sync] Auto sync error:",n.t0);case 11:case"end":return n.stop()}}),n,null,[[1,8]])}))))}}}]);