/*! For license information please see 15.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkapp_starter_project_with_webpack=self.webpackChunkapp_starter_project_with_webpack||[]).push([[15],{15:(e,r,t)=>{t.r(r),t.d(r,{getPushSubscription:()=>C,getVapidPublicKey:()=>k,registerServiceWorker:()=>x,removeSubscriptionFromServer:()=>T,sendSubscriptionToServer:()=>E,subscribeToPush:()=>_,unsubscribeFromPush:()=>I});var n=t(255);function o(){var e=p(),r=e.m(o),t=(Object.getPrototypeOf?Object.getPrototypeOf(r):r.__proto__).constructor;function n(e){var r="function"==typeof e&&e.constructor;return!!r&&(r===t||"GeneratorFunction"===(r.displayName||r.name))}var l={throw:1,return:2,break:3,continue:3};function h(e){var r,t;return function(n){r||(r={stop:function(){return t(n.a,2)},catch:function(){return n.v},abrupt:function(e,r){return t(n.a,l[e],r)},delegateYield:function(e,o,c){return r.resultName=o,t(n.d,u(e),c)},finish:function(e){return t(n.f,e)}},t=function(e,t,o){n.p=r.prev,n.n=r.next;try{return e(t,o)}finally{r.next=n.n}}),r.resultName&&(r[r.resultName]=n.v,r.resultName=void 0),r.sent=n.v,r.next=n.n;try{return e.call(this,r)}finally{n.p=r.prev,n.n=r.next}}}return(o=function(){return{wrap:function(r,t,n,o){return e.w(h(r),t,n,o&&o.reverse())},isGeneratorFunction:n,mark:e.m,awrap:function(e,r){return new f(e,r)},AsyncIterator:a,async:function(e,r,t,o,u){return(n(r)?s:i)(h(e),r,t,o,u)},keys:c,values:u}})()}function u(e){if(null!=e){var r=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],t=0;if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&t>=e.length&&(e=void 0),{value:e&&e[t++],done:!e}}}}throw new TypeError(h(e)+" is not iterable")}function c(e){var r=Object(e),t=[];for(var n in r)t.unshift(n);return function e(){for(;t.length;)if((n=t.pop())in r)return e.value=n,e.done=!1,e;return e.done=!0,e}}function i(e,r,t,n,o){var u=s(e,r,t,n,o);return u.next().then((function(e){return e.done?e.value:u.next()}))}function s(e,r,t,n,o){return new a(p().w(e,r,t,n),o||Promise)}function a(e,r){function t(n,o,u,c){try{var i=e[n](o),s=i.value;return s instanceof f?r.resolve(s.v).then((function(e){t("next",e,u,c)}),(function(e){t("throw",e,u,c)})):r.resolve(s).then((function(e){i.value=e,u(i)}),(function(e){return t("throw",e,u,c)}))}catch(e){c(e)}}var n;this.next||(l(a.prototype),l(a.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",(function(){return this}))),l(this,"_invoke",(function(e,o,u){function c(){return new r((function(r,n){t(e,u,r,n)}))}return n=n?n.then(c,c):c()}),!0)}function p(){var e,r,t="function"==typeof Symbol?Symbol:{},n=t.iterator||"@@iterator",o=t.toStringTag||"@@toStringTag";function u(t,n,o,u){var s=n&&n.prototype instanceof i?n:i,a=Object.create(s.prototype);return l(a,"_invoke",function(t,n,o){var u,i,s,a=0,p=o||[],l=!1,f={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(r,t){return u=r,i=0,s=e,f.n=t,c}};function h(t,n){for(i=t,s=n,r=0;!l&&a&&!o&&r<p.length;r++){var o,u=p[r],h=f.p,b=u[2];t>3?(o=b===n)&&(s=u[(i=u[4])?5:(i=3,3)],u[4]=u[5]=e):u[0]<=h&&((o=t<2&&h<u[1])?(i=0,f.v=n,f.n=u[1]):h<b&&(o=t<3||u[0]>n||n>b)&&(u[4]=t,u[5]=n,f.n=b,i=0))}if(o||t>1)return c;throw l=!0,n}return function(o,p,b){if(a>1)throw TypeError("Generator is already running");for(l&&1===p&&h(p,b),i=p,s=b;(r=i<2?e:s)||!l;){u||(i?i<3?(i>1&&(f.n=-1),h(i,s)):f.n=s:f.v=s);try{if(a=2,u){if(i||(o="next"),r=u[o]){if(!(r=r.call(u,s)))throw TypeError("iterator result is not an object");if(!r.done)return r;s=r.value,i<2&&(i=0)}else 1===i&&(r=u.return)&&r.call(u),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);u=e}else if((r=(l=f.n<0)?s:t.call(n,f))!==c)break}catch(r){u=e,i=1,s=r}finally{a=1}}return{value:r,done:l}}}(t,o,u),!0),a}var c={};function i(){}function s(){}function a(){}r=Object.getPrototypeOf;var f=[][n]?r(r([][n]())):(l(r={},n,(function(){return this})),r),h=a.prototype=i.prototype=Object.create(f);function b(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,l(e,o,"GeneratorFunction")),e.prototype=Object.create(h),e}return s.prototype=a,l(h,"constructor",a),l(a,"constructor",s),s.displayName="GeneratorFunction",l(a,o,"GeneratorFunction"),l(h),l(h,o,"Generator"),l(h,n,(function(){return this})),l(h,"toString",(function(){return"[object Generator]"})),(p=function(){return{w:u,m:b}})()}function l(e,r,t,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}l=function(e,r,t,n){function u(r,t){l(e,r,(function(e){return this._invoke(r,t,e)}))}r?o?o(e,r,{value:t,enumerable:!n,configurable:!n,writable:!n}):e[r]=t:(u("next",0),u("throw",1),u("return",2))},l(e,r,t,n)}function f(e,r){this.v=e,this.k=r}function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function b(e,r,t,n,o,u,c){try{var i=e[u](c),s=i.value}catch(e){return void t(e)}i.done?r(s):Promise.resolve(s).then(n,o)}function v(e){return function(){var r=this,t=arguments;return new Promise((function(n,o){var u=e.apply(r,t);function c(e){b(u,n,o,c,i,"next",e)}function i(e){b(u,n,o,c,i,"throw",e)}c(void 0)}))}}console.log("[push-notification] Module loaded. CONFIG.VAPID_PUBLIC_KEY:",n.A.VAPID_PUBLIC_KEY?n.A.VAPID_PUBLIC_KEY.substring(0,20)+"...":"MISSING");var y=null,d=!1,g=!1;function k(){return m.apply(this,arguments)}function m(){return(m=v(o().mark((function e(){var r,t,u,c,i,s,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[push] getVapidPublicKey called. CONFIG:",n.A),console.log("[push] CONFIG.VAPID_PUBLIC_KEY type:",h(n.A.VAPID_PUBLIC_KEY)),console.log("[push] CONFIG.VAPID_PUBLIC_KEY value:",n.A.VAPID_PUBLIC_KEY),!n.A.VAPID_PUBLIC_KEY||""===n.A.VAPID_PUBLIC_KEY.trim()){e.next=6;break}return console.log("[push] ✅ VAPID key found in CONFIG:",n.A.VAPID_PUBLIC_KEY.substring(0,20)+"..."),e.abrupt("return",n.A.VAPID_PUBLIC_KEY);case 6:if(console.warn("[push] ❌ CONFIG.VAPID_PUBLIC_KEY is empty or undefined"),!d){e.next=9;break}return e.abrupt("return",y);case 9:return d=!0,e.prev=10,r=n.A.BASE_URL.replace(/\/+$/,""),t=new AbortController,u=setTimeout((function(){return t.abort()}),1e3),e.prev=14,c=fetch("".concat(r,"/vapid-public-key"),{method:"GET",signal:t.signal,headers:{Accept:"application/json"},cache:"default"}),i=new Promise((function(e,r){return setTimeout((function(){return r(new Error("timeout"))}),1e3)})),e.next=19,Promise.race([c.catch((function(){return null})),i.catch((function(){return null}))]);case 19:if(s=e.sent,clearTimeout(u),!s||!s.ok){e.next=33;break}return e.prev=22,e.next=25,s.json();case 25:if(!(a=e.sent).publicKey){e.next=29;break}return y=a.publicKey,e.abrupt("return",y);case 29:e.next=33;break;case 31:e.prev=31,e.t0=e.catch(22);case 33:y=null,e.next=40;break;case 36:e.prev=36,e.t1=e.catch(14),clearTimeout(u),y=null;case 40:e.next=45;break;case 42:e.prev=42,e.t2=e.catch(10),y=null;case 45:return e.abrupt("return",y);case 46:case"end":return e.stop()}}),e,null,[[10,42],[14,36],[22,31]])})))).apply(this,arguments)}function P(e){for(var r=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),t=window.atob(r),n=new Uint8Array(t.length),o=0;o<t.length;++o)n[o]=t.charCodeAt(o);return n}function x(){return S.apply(this,arguments)}function S(){return(S=v(o().mark((function e(){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("serviceWorker"in navigator)){e.next=13;break}return e.prev=1,e.next=4,navigator.serviceWorker.register("/sw.js",{scope:"/"});case 4:return r=e.sent,console.log("[push] Service Worker registered:",r),e.abrupt("return",r);case 9:return e.prev=9,e.t0=e.catch(1),console.error("[push] Service Worker registration failed:",e.t0),e.abrupt("return",null);case 13:return e.abrupt("return",null);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}function _(e){return w.apply(this,arguments)}function w(){return(w=v(o().mark((function e(r){var t,u,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}throw new Error("Service Worker registration not available");case 2:if(e.prev=2,(t=n.A.VAPID_PUBLIC_KEY)&&""!==t.trim()){e.next=11;break}return console.log("[push] CONFIG.VAPID_PUBLIC_KEY not found, trying getVapidPublicKey()..."),e.next=8,k();case 8:t=e.sent,e.next=12;break;case 11:console.log("[push] ✅ Using VAPID key from CONFIG directly");case 12:if(t){e.next=15;break}return console.error("[push] ❌ VAPID public key tidak ditemukan. Pastikan CONFIG.VAPID_PUBLIC_KEY di-set di config.js"),e.abrupt("return",null);case 15:return console.log("[push] Converting VAPID key..."),u=P(t),console.log("[push] Subscribing to push..."),e.next=20,r.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:u});case 20:return c=e.sent,console.log("[push] ✅ Successfully subscribed to push"),e.abrupt("return",c);case 25:return e.prev=25,e.t0=e.catch(2),console.error("[push] ❌ Failed to subscribe:",e.t0),e.abrupt("return",null);case 29:case"end":return e.stop()}}),e,null,[[2,25]])})))).apply(this,arguments)}function I(e){return A.apply(this,arguments)}function A(){return(A=v(o().mark((function e(r){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",!1);case 2:return e.prev=2,e.next=5,r.pushManager.getSubscription();case 5:if(!(t=e.sent)){e.next=11;break}return e.next=9,t.unsubscribe();case 9:return console.log("[push] Unsubscribed from push"),e.abrupt("return",!0);case 11:return e.abrupt("return",!1);case 14:return e.prev=14,e.t0=e.catch(2),console.error("[push] Failed to unsubscribe:",e.t0),e.abrupt("return",!1);case 18:case"end":return e.stop()}}),e,null,[[2,14]])})))).apply(this,arguments)}function C(e){return O.apply(this,arguments)}function O(){return(O=v(o().mark((function e(r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",null);case 2:return e.prev=2,e.next=5,r.pushManager.getSubscription();case 5:return e.abrupt("return",e.sent);case 8:return e.prev=8,e.t0=e.catch(2),console.error("[push] Failed to get subscription:",e.t0),e.abrupt("return",null);case 12:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function E(e){return F.apply(this,arguments)}function F(){return(F=v(o().mark((function e(r){var t,u,c,i,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!g){e.next=3;break}return console.log("[push] ℹ️ Skipping server subscription (CORS issue detected). Push notification tetap berfungsi secara lokal."),e.abrupt("return",null);case 3:if(t=localStorage.getItem("authToken")){e.next=7;break}return console.log("[push] ℹ️ User not authenticated, skipping server subscription"),e.abrupt("return",null);case 7:return u=n.A.BASE_URL.replace(/\/+$/,""),c=r.toJSON(),e.prev=9,e.next=12,fetch("".concat(u,"/stories/subscription"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({endpoint:c.endpoint,keys:c.keys})});case 12:if((i=e.sent).ok){e.next=19;break}return e.next=16,i.json().catch((function(){return{}}));case 16:return e.sent,console.log("[push] ℹ️ Server subscription failed (HTTP ".concat(i.status,"). Push notification tetap berfungsi secara lokal.")),e.abrupt("return",null);case 19:return e.next=21,i.json().catch((function(){return{}}));case 21:return s=e.sent,console.log("[push] ✅ Subscription sent to server successfully"),e.abrupt("return",s);case 26:return e.prev=26,e.t0=e.catch(9),e.t0.message.includes("CORS")||e.t0.message.includes("fetch")||e.t0.message.includes("Failed to fetch")?(g=!0,console.log("[push] ℹ️ CORS error terdeteksi: Server tidak mengizinkan request dari localhost."),console.log("[push] ℹ️ Push notification tetap berfungsi secara lokal. Server calls akan di-skip untuk session ini.")):console.log("[push] ℹ️ Failed to send subscription to server:",e.t0.message),e.abrupt("return",null);case 31:case"end":return e.stop()}}),e,null,[[9,26]])})))).apply(this,arguments)}function T(){return U.apply(this,arguments)}function U(){return(U=v(o().mark((function e(){var r,t,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!g){e.next=3;break}return console.log("[push] ℹ️ Skipping server unsubscription (CORS issue detected)."),e.abrupt("return",!1);case 3:if(r=localStorage.getItem("authToken")){e.next=7;break}return console.log("[push] ℹ️ User not authenticated, skipping server unsubscription"),e.abrupt("return",!1);case 7:return t=n.A.BASE_URL.replace(/\/+$/,""),e.prev=8,e.next=11,fetch("".concat(t,"/stories/subscription"),{method:"DELETE",headers:{Authorization:"Bearer ".concat(r)}});case 11:if((u=e.sent).ok){e.next=18;break}return e.next=15,u.json().catch((function(){return{}}));case 15:return e.sent,console.log("[push] ℹ️ Server unsubscription failed (HTTP ".concat(u.status,").")),e.abrupt("return",!1);case 18:return console.log("[push] ✅ Subscription removed from server"),e.abrupt("return",!0);case 22:return e.prev=22,e.t0=e.catch(8),e.t0.message.includes("CORS")||e.t0.message.includes("fetch")||e.t0.message.includes("Failed to fetch")?(g=!0,console.log("[push] ℹ️ CORS error terdeteksi. Server calls akan di-skip untuk session ini.")):console.log("[push] ℹ️ Failed to remove subscription from server:",e.t0.message),e.abrupt("return",!1);case 27:case"end":return e.stop()}}),e,null,[[8,22]])})))).apply(this,arguments)}}}]);